<!DOCTYPE html>
<html>
<head>
  <title>Clue-Less</title>
  <style>
    body {
      margin: 0;
      padding-bottom: 3rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    #form {
      background: rgba(0, 0, 0, 0.15);
      padding: 0.25rem;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      height: 3rem;
      box-sizing: border-box;
      backdrop-filter: blur(10px);
    }

    #input {
      border: none;
      padding: 0 1rem;
      flex-grow: 1;
      border-radius: 2rem;
      margin: 0.25rem;
    }

    #input:focus {
      outline: none;
    }

    #form>button {
      background: #333;
      border: none;
      padding: 0 1rem;
      margin: 0.25rem;
      border-radius: 3px;
      outline: none;
      color: #fff;
    }

    #messages {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    #messages>li {
      padding: 0.5rem 1rem;
    }

    #messages>li:nth-child(odd) {
      background: #efefef;
    }
  </style>
</head>

<body>
  <ul id="messages"></ul>
  <form id="form" action="">
    <input id="input" autocomplete="off" /><button>Enter Name to Join Game</button>
  </form>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();

    var form = document.getElementById('form');
    var input = document.getElementById('input');
    var messages = document.getElementById('messages');
    var gameId = 'MockGameId';
    var playerId;
    var character;
    let cards;

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      if (input.value) {
        playerId = input.value;
        socket.emit(
          'start',
          {
            gameId: gameId,
            playerId: input.value
          });
        input.value = '';
      }
    });

    socket.on('insufficientPlayerCount', function () {
      console.log("Insufficient number of players");
      print_message("Waiting for more players...");
    });

    socket.on('PLAYER_START_INFO', function (player) {
      console.log("Player start info:");
      console.log(player);
      character = player.character;
      cards = player.cards;

      print_message("Character assigned to player: " + player.character.name);
      print_message("Cards assigned to player: " + JSON.stringify(player.cards));
    });

    socket.on('GAME_STATE', function (obj) {
      console.log("Game state:");
      console.log(obj);

      print_message("New game state recieved from server:");
      print_message("Characters: " + JSON.stringify(obj.characterPieces));
      print_message("Weapons: " + JSON.stringify(obj.weaponPieces));
    });

    socket.on('REQUESTING_MOVE_BROADCAST', function (obj) {
      print_message(`It is now ${playerId}'s turn.`);
    });

    socket.on('REQUEST_MOVE', function (obj) {
      print_message("You have been requested to provide a move, so you are providing move: " + obj.potentialMoves[0]);
      socket.emit(
        'move',
        {
          gameId: gameId,
          playerId: playerId,
          newCharacterLocation: obj.potentialMoves[0]
        });
    });

    socket.on('REQUEST_SUGGESTION', function (obj) {
      let suggestion =
      {
        gameId: gameId,
        playerId: playerId,
        suggestedCharacterName: 'MUSTARD',
        suggestedWeaponName: 'PIPE'
      };

      print_message("You have been requested to provide a suggestion, so you are providing suggestion:" + JSON.stringify(suggestion));
      socket.emit(
        'suggestion',
        suggestion);
    });

    socket.on('REQUEST_PROOF', function (obj) {
      let chosenProofCard;
      if (cards.map(a => a.name).includes(obj.suggestedCharacterName))
      {
        chosenProofCard = obj.suggestedCharacterName;
      }

      if (cards.map(a => a.name).includes(obj.suggestedLocation))
      {
        chosenProofCard = obj.suggestedLocation;
      }

      if (cards.map(a => a.name).includes(obj.suggestedWeaponName))
      {
        chosenProofCard = obj.suggestedWeaponName;
      }

      let proof = {
        gameId: gameId,
        playerId: playerId,
        proofCard: chosenProofCard
      }
      print_message("You have been asked to provide proof for suggstion [" + `${obj.suggestedCharacterName}, ${obj.suggestedWeaponName}, ${obj.suggestedLocation}` + "], so you are providing proof: " + JSON.stringify(proof));

      socket.emit(
        'proof',
        proof);
    });

    socket.on('IS_PROOF_PROVIDED', function (obj) {
      print_message("Information regarding proof being provided for prior suggestion: " + JSON.stringify(obj));
    });

    socket.on('PROOF_PROVIDED', function (obj) {
      print_message("Proof that was provided is: " + JSON.stringify(obj));
    });

    socket.on('ACCUSATION_CORRECT', function (obj) {
      print_message(`Player ${obj.winningPlayer} has won. Solution to the mystery is ${obj.accusedCharacter} in ${obj.accusedLocation} with ${obj.accusedWeapon}.`);
    });

    function print_message(msg) {
      let item = document.createElement('li');
      item.textContent = msg;
      messages.appendChild(item);
    }
  </script>
</body>
</html>